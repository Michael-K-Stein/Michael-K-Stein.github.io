(function(){"use strict";self.onmessage=async n=>{const{id:r,data:t,password:e,mode:a}=n.data;try{let s;if(t instanceof Blob)a==="encrypt"?s=await w(t,e):s=await p(t,e);else if(t instanceof Uint8Array)a==="encrypt"?s=await i(t,e):s=await y(t,e);else throw new Error("Unsupported data type: must be Blob or Uint8Array");self.postMessage({id:r,result:s})}catch(s){self.postMessage({id:r,error:String(s)})}};const l=new TextEncoder;async function o(n,r,t){const e=globalThis.crypto||window.crypto;if(!e?.subtle)throw new Error("WebCrypto unavailable");const a=await e.subtle.importKey("raw",l.encode(n),"PBKDF2",!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:r,iterations:1e5,hash:"SHA-256"},a,{name:"AES-GCM",length:256},!1,t)}async function i(n,r){const t=crypto.getRandomValues(new Uint8Array(16)),e=crypto.getRandomValues(new Uint8Array(12)),a=await o(r,t,["encrypt"]),s=new Uint8Array(await crypto.subtle.encrypt({name:"AES-GCM",iv:e},a,n)),c=new Uint8Array(28+s.length);return c.set(t,0),c.set(e,16),c.set(s,28),c}async function y(n,r){const t=n.slice(0,16),e=n.slice(16,28),a=n.slice(28),s=await o(r,t,["decrypt"]);return new Uint8Array(await crypto.subtle.decrypt({name:"AES-GCM",iv:e},s,a))}async function w(n,r){const t=await n.arrayBuffer(),e=new Uint8Array(t),a=await i(e,r);return new Blob([a])}async function p(n,r){const t=await n.arrayBuffer(),e=new Uint8Array(t),a=await y(e,r);return new Blob([a])}})();
