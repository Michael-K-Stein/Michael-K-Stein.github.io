(function(){"use strict";self.onmessage=async t=>{const{id:r,data:n,password:e,mode:a}=t.data;try{const s=a==="encrypt"?await y(n,e):await l(n,e);self.postMessage({id:r,result:s})}catch(s){self.postMessage({id:r,error:String(s)})}};const i=new TextEncoder;async function o(t,r,n){const e=globalThis.crypto||window.crypto;if(!e?.subtle)throw new Error("WebCrypto unavailable");const a=await e.subtle.importKey("raw",i.encode(t),"PBKDF2",!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:r,iterations:1e5,hash:"SHA-256"},a,{name:"AES-GCM",length:256},!1,n)}async function y(t,r){const n=crypto.getRandomValues(new Uint8Array(16)),e=crypto.getRandomValues(new Uint8Array(12)),a=await o(r,n,["encrypt"]),s=new Uint8Array(await crypto.subtle.encrypt({name:"AES-GCM",iv:e},a,t)),c=new Uint8Array(28+s.length);return c.set(n,0),c.set(e,16),c.set(s,28),c}async function l(t,r){const n=t.slice(0,16),e=t.slice(16,28),a=t.slice(28),s=await o(r,n,["decrypt"]);return new Uint8Array(await crypto.subtle.decrypt({name:"AES-GCM",iv:e},s,a))}})();
